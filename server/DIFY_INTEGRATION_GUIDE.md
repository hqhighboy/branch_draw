# Dify工作流集成指南

本指南将帮助您了解如何使用本地Docker安装的Dify工作流从Excel表格中提取数据并更新到系统中。

## 什么是Dify？

Dify是一个低代码AI应用开发平台，可以帮助您快速构建、部署和监控AI应用。在本项目中，我们使用Dify来构建数据处理工作流，实现从Excel表格中提取数据并更新到系统中的功能。

## 前提条件

在开始使用Dify工作流之前，您需要：

1. 已通过Docker在本地安装Dify（http://localhost/apps）
2. 创建一个API密钥（在本地Dify实例中）
3. 确保您的系统已经安装了Node.js和npm

## 配置步骤

### 1. 配置Dify API

首先，您需要配置Dify API密钥：

1. 登录您的本地Dify实例（[http://localhost/apps](http://localhost/apps)）
2. 在Dify控制台中，点击左侧菜单中的"应用"，选择您要使用的应用
3. 在应用详情页面，点击"API访问"或"API参考"选项卡
4. 在API访问页面，您可以找到API密钥（通常有"API Key"或"Secret Key"标识）
5. 复制该API密钥
6. 登录系统，进入"Dify工作流管理"页面
7. 切换到"配置"标签页
8. 点击"编辑配置"按钮
9. 输入您的Dify API密钥和API基础URL（使用`http://localhost/api/v1`）
10. 点击"保存"按钮

### 2. 创建工作流

配置API密钥后，您需要创建一个工作流：

1. 在"配置"标签页中，点击"创建工作流"按钮
2. 系统将自动创建一个工作流，并显示工作流ID
3. 您可以在本地Dify实例（[http://localhost/apps](http://localhost/apps)）中查看和管理这个工作流

### 3. 准备Excel数据

您需要准备一个符合模板格式的Excel文件：

1. 在"数据导入"标签页中，点击"下载导入模板"按钮
2. 根据模板格式填写您的数据
3. 保存Excel文件

### 4. 导入数据

准备好Excel文件后，您可以导入数据：

1. 在"数据导入"标签页中，点击"上传Excel文件"按钮
2. 选择您准备好的Excel文件
3. 系统将自动处理数据并显示导入结果

## 工作流执行过程

当您上传Excel文件后，系统会执行以下步骤：

1. **验证Excel文件**：检查文件格式是否正确
2. **提取数据**：从Excel文件中提取数据
3. **转换数据**：将数据转换为系统可用的格式
4. **更新数据库**：将数据更新到系统中
5. **发送通知**：通知用户导入结果

您可以在"执行历史"标签页中查看工作流的执行情况。

## 常见问题

### 1. 如何更新工作流？

如果您需要更新工作流的定义，可以在"配置"标签页中点击"更新工作流"按钮。

### 2. 如何处理导入错误？

如果导入过程中出现错误，系统会显示错误信息。您可以根据错误信息修复数据，然后重新导入。

### 3. 如何查看导入历史？

您可以在"执行历史"标签页中查看所有的导入历史记录。

### 4. 如何测试API连接？

您可以在"配置"标签页中点击"测试连接"按钮，测试与Dify API的连接状态。

## 高级功能

### 1. 定时导入

您可以配置定时导入功能，系统会在指定的时间自动执行导入任务：

1. 登录您的本地Dify实例（[http://localhost/apps](http://localhost/apps)）
2. 找到您的工作流
3. 配置触发器，选择"定时触发"
4. 设置执行时间（例如每天0点）
5. 保存配置

### 2. 自定义工作流

如果您需要自定义工作流的行为，可以修改工作流定义：

1. 编辑`server/dify-workflow-config.js`文件
2. 修改工作流定义
3. 重启服务器
4. 在"配置"标签页中点击"更新工作流"按钮

## 技术支持

如果您在使用过程中遇到任何问题，请联系技术支持团队：

- 电子邮件：[support@example.com](mailto:support@example.com)
- 电话：123-456-7890

## 本地Docker环境特别说明

由于您使用的是本地Docker安装的Dify，请注意以下几点：

1. **API访问地址**：使用`http://localhost/api/v1`作为API基础URL
2. **Web界面访问地址**：使用`http://localhost/apps`访问Dify控制台
3. **网络连接**：确保您的应用服务器可以访问Docker容器网络
4. **数据持久化**：Dify的数据存储在Docker卷中，请确保定期备份
5. **资源限制**：根据您的Docker配置，可能需要调整资源限制以获得更好的性能

如果您需要更新Dify版本，请参考Docker官方文档进行操作，并确保备份您的数据。
