# 模糊匹配Excel导入功能使用指南

本指南将帮助您使用模糊匹配Excel导入功能，将Excel表格数据导入到系统数据库中。

## 功能特点

1. **模糊匹配字段名**：即使Excel表格中的列名与数据库字段名不完全一致，系统也能智能匹配
2. **自动识别工作表内容**：系统会自动识别包含支部信息、年龄分布、学历分布等内容的工作表
3. **数据类型自动转换**：系统会自动处理数据类型转换，如百分比、数字等
4. **支持更新现有数据**：如果数据已存在，系统会更新而不是重复插入
5. **详细的导入报告**：导入完成后会生成详细的导入报告

## 准备工作

1. **确保MySQL数据库已启动**
2. **确保已安装必要的依赖**：
   ```
   cd D:\Projects\cursor\branch-analysis\server
   npm install string-similarity xlsx mysql2
   ```

## 使用方法

### 1. 创建Excel模板（可选）

如果您需要一个标准的Excel模板，可以运行：

```
cd D:\Projects\cursor\branch-analysis\server
node create-template.js
```

这将在server目录下生成一个名为`import_template.xlsx`的Excel文件，包含所有必要的工作表和示例数据。

### 2. 准备Excel数据文件

您可以使用系统生成的模板，或者准备自己的Excel文件。Excel文件应包含以下工作表：

- **支部基本信息**（必需）：包含支部名称、书记、副书记等基本信息
- **年龄分布**（可选）：包含各支部的年龄分布数据
- **学历分布**（可选）：包含各支部的学历分布数据
- **技能分布**（可选）：包含各支部的技能分布数据
- **职称分布**（可选）：包含各支部的职称分布数据
- **年度工作**（可选）：包含各支部的年度工作计划

### 3. 运行导入工具

有两种方式运行导入工具：

#### 简化版导入工具（推荐）

```
cd D:\Projects\cursor\branch-analysis\server
node simple-import.js
```

简化版导入工具会提示您输入Excel文件路径。您可以：

1. **输入自定义Excel文件路径**：将您的Excel数据文件放在任意位置，然后输入完整路径，例如：`D:\Data\branch_data.xlsx`

2. **直接按回车**：如果您想使用默认模板（`import_template.xlsx`），可以直接按回车。

#### 完整版导入工具

```
cd D:\Projects\cursor\branch-analysis\server
node import-data.js
```

完整版导入工具会提示您输入Excel文件路径，并显示详细的字段映射结果。

### 4. 查看导入结果

导入完成后，系统会显示导入结果报告，包括：

- 成功导入的记录数
- 更新的记录数
- 错误记录数及错误原因

## Excel文件格式要求

### 支部基本信息工作表
应包含以下字段（字段名称可以不完全一致，工具会进行模糊匹配）：
- 支部名称
- 书记
- 副书记
- 组织委员
- 纪检委员
- 宣传委员
- 学习委员
- 支部人数
- 平均年龄
- 上年度绩效
- 书记项目
- 获得荣誉

### 年龄分布工作表
应包含以下字段：
- 支部名称（用于关联支部）
- 18-28岁
- 28-35岁
- 35-50岁
- 50-60岁

### 学历分布工作表
应包含以下字段：
- 支部名称（用于关联支部）
- 大专及以下
- 本科
- 硕士
- 博士

### 技能分布工作表
应包含以下字段：
- 支部名称（用于关联支部）
- 初中级工
- 高级工
- 技师
- 高级技师

### 职称分布工作表
应包含以下字段：
- 支部名称（用于关联支部）
- 助理工程师
- 工程师
- 高级工程师
- 正高级工程师

### 年度工作工作表
应包含以下字段：
- 支部名称（用于关联支部）
- 工作任务
- 开始时间
- 结束时间
- 状态
- 进度

## 注意事项

- 确保Excel文件中的支部名称与数据库中的支部名称一致，这是关联数据的关键
- 导入前会显示字段映射结果，请仔细检查确认
- 如果遇到错误，请查看错误报告
- 如果需要修改数据库字段名称，请同时修改导入脚本中的字段名称

## 故障排除

### 问题：导入工具没有响应

可能原因：
- 数据库未启动
- 数据库连接信息不正确
- 依赖包未安装

解决方法：
1. 确保MySQL数据库已启动
2. 检查`db.js`中的数据库连接信息
3. 运行`npm install string-similarity xlsx mysql2`安装依赖

### 问题：字段名称不匹配

可能原因：
- Excel文件中的字段名称与系统预期的不一致
- 数据库表结构与导入脚本中的定义不一致

解决方法：
1. 使用系统生成的模板作为参考
2. 修改Excel文件中的字段名称
3. 或者修改导入脚本中的字段映射定义

### 问题：数据导入后不显示

可能原因：
- 支部名称不匹配
- 数据格式不正确

解决方法：
1. 确保Excel文件中的支部名称与数据库中的支部名称完全一致
2. 检查数据格式，特别是日期和数字格式
