/**
 * 创建员工信息导入模板
 * 
 * 此脚本用于创建员工信息导入模板Excel文件
 */

const xlsx = require('xlsx');
const path = require('path');
const fs = require('fs');

/**
 * 创建员工信息导入模板
 * @param {string} outputPath 输出文件路径
 */
function createEmployeeTemplate(outputPath) {
  // 创建工作簿
  const workbook = xlsx.utils.book_new();
  
  // 定义所有字段
  const headers = [
    '员工基本信息-姓名',
    '员工基本信息-员工编码',
    '员工基本信息-性别',
    '员工基本信息-出生日期',
    '员工基本信息-年龄',
    '员工基本信息-民族',
    '员工基本信息-籍贯',
    '员工基本信息-工龄',
    '员工基本信息-出生地',
    '员工基本信息-文化程度',
    '员工基本信息-政治面貌',
    '组织信息-单位名称',
    '组织信息-部门名称',
    '组织信息-部门路径',
    '组织信息-班组名称',
    '组织信息-岗位名称',
    '组织信息-岗位层级',
    '组织信息-岗位类别',
    '组织信息-岗位专业分类',
    '组织信息-岗位序列',
    '职务信息-现任职务',
    '职务信息-现任职务级别',
    '技术专家-技术专家等级',
    '技术专家-技术专家专业',
    '技能专家-技能专家等级',
    '技能专家-技能专家专业',
    '员工工作信息-任职年限',
    '员工工作信息-现任岗位聘任日期',
    '员工工作信息-参加工作日期',
    '员工工作信息-连续工龄起算日期',
    '员工工作信息-入南网系统日期',
    '员工工作信息-入本单位日期',
    '员工联系信息-手机',
    '学历学位教育-有学历学位教育-(入学日期,毕业日期,毕业院校,院校类别)',
    '职称资格证书-多个职称资格证书-(资格名称,资格等级,专业名称,分支专业,资格取得时间,审批发证单位,是否当前证书,入库时间)',
    '职称资格证书-当前-职称资格证书资格名称',
    '职称资格证书-当前-职称资格证书资格等级',
    '职称资格证书-当前-职称资格证书专业名称',
    '职称资格证书-当前-职称资格证书分支专业',
    '职称资格证书-当前-职称资格证书资格取得时间',
    '职称资格证书-当前-职称资格证书审批发证单位',
    '职称资格证书-当前-职称资格证书入库时间',
    '岗位胜任能力资格证书-多个岗位胜任能力资格证书-(资格名称,岗位胜任能力证书等级,资格取得时间,审批发证单位,是否当前)',
    '岗位胜任能力资格证书-当前-岗位胜任能力资格证书资格名称',
    '岗位胜任能力资格证书-当前-岗位胜任能力证书等级',
    '岗位胜任能力资格证书-当前-岗位胜任能力资格证书资格取得时间',
    '岗位胜任能力资格证书-当前-岗位胜任能力资格证书审批发证单位',
    '职业技能等级认定证书-多个职业技能等级认定证书-(资格名称,资格等级,工种名称,资格取得时间,审批发证单位,证书编号,入库时间,是否当前证书)',
    '职业技能等级认定证书-当前-职业技能等级认定证书资格名称',
    '职业技能等级认定证书-当前-职业技能等级认定证书资格等级',
    '职业技能等级认定证书-当前-职业技能等级认定证书工种名称',
    '职业技能等级认定证书-当前-职业技能等级认定证书资格取得时间',
    '职业技能等级认定证书-当前-职业技能等级认定证书审批发证单位',
    '职业技能等级认定证书-当前-职业技能等级认定证书证书编号',
    '职业技能等级认定证书-当前-职业技能等级认定证书入库时间'
  ];
  
  // 创建示例数据
  const exampleData = [
    {
      '员工基本信息-姓名': '张三',
      '员工基本信息-员工编码': 'EMP001',
      '员工基本信息-性别': '男',
      '员工基本信息-出生日期': '1985-01-15',
      '员工基本信息-年龄': 38,
      '员工基本信息-民族': '汉族',
      '员工基本信息-籍贯': '广东省广州市',
      '员工基本信息-工龄': 15.5,
      '员工基本信息-出生地': '广东省广州市',
      '员工基本信息-文化程度': '本科',
      '员工基本信息-政治面貌': '中共党员',
      '组织信息-单位名称': '南方电网公司',
      '组织信息-部门名称': '党建人事部',
      '组织信息-部门路径': '南方电网公司/党建人事部',
      '组织信息-班组名称': '人力资源管理班组',
      '组织信息-岗位名称': '人力资源专员',
      '组织信息-岗位层级': '专业',
      '组织信息-岗位类别': '管理',
      '组织信息-岗位专业分类': '人力资源',
      '组织信息-岗位序列': 'M3',
      '职务信息-现任职务': '主管',
      '职务信息-现任职务级别': '中级',
      '技术专家-技术专家等级': '',
      '技术专家-技术专家专业': '',
      '技能专家-技能专家等级': '',
      '技能专家-技能专家专业': '',
      '员工工作信息-任职年限': 5.5,
      '员工工作信息-现任岗位聘任日期': '2018-06-01',
      '员工工作信息-参加工作日期': '2008-07-01',
      '员工工作信息-连续工龄起算日期': '2008-07-01',
      '员工工作信息-入南网系统日期': '2010-03-15',
      '员工工作信息-入本单位日期': '2010-03-15',
      '员工联系信息-手机': '13800138000',
      '学历学位教育-有学历学位教育-(入学日期,毕业日期,毕业院校,院校类别)': '2004-09-01,2008-06-30,华南理工大学,211',
      '职称资格证书-多个职称资格证书-(资格名称,资格等级,专业名称,分支专业,资格取得时间,审批发证单位,是否当前证书,入库时间)': '人力资源管理师,中级,人力资源,人力资源管理,2015-05-20,人社部,是,2015-06-01',
      '职称资格证书-当前-职称资格证书资格名称': '人力资源管理师',
      '职称资格证书-当前-职称资格证书资格等级': '中级',
      '职称资格证书-当前-职称资格证书专业名称': '人力资源',
      '职称资格证书-当前-职称资格证书分支专业': '人力资源管理',
      '职称资格证书-当前-职称资格证书资格取得时间': '2015-05-20',
      '职称资格证书-当前-职称资格证书审批发证单位': '人社部',
      '职称资格证书-当前-职称资格证书入库时间': '2015-06-01',
      '岗位胜任能力资格证书-多个岗位胜任能力资格证书-(资格名称,岗位胜任能力证书等级,资格取得时间,审批发证单位,是否当前)': '',
      '岗位胜任能力资格证书-当前-岗位胜任能力资格证书资格名称': '',
      '岗位胜任能力资格证书-当前-岗位胜任能力证书等级': '',
      '岗位胜任能力资格证书-当前-岗位胜任能力资格证书资格取得时间': '',
      '岗位胜任能力资格证书-当前-岗位胜任能力资格证书审批发证单位': '',
      '职业技能等级认定证书-多个职业技能等级认定证书-(资格名称,资格等级,工种名称,资格取得时间,审批发证单位,证书编号,入库时间,是否当前证书)': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书资格名称': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书资格等级': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书工种名称': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书资格取得时间': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书审批发证单位': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书证书编号': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书入库时间': ''
    },
    {
      '员工基本信息-姓名': '李四',
      '员工基本信息-员工编码': 'EMP002',
      '员工基本信息-性别': '女',
      '员工基本信息-出生日期': '1990-05-20',
      '员工基本信息-年龄': 33,
      '员工基本信息-民族': '汉族',
      '员工基本信息-籍贯': '广东省深圳市',
      '员工基本信息-工龄': 10.2,
      '员工基本信息-出生地': '广东省深圳市',
      '员工基本信息-文化程度': '硕士',
      '员工基本信息-政治面貌': '中共党员',
      '组织信息-单位名称': '南方电网公司',
      '组织信息-部门名称': '生产技术部',
      '组织信息-部门路径': '南方电网公司/生产技术部',
      '组织信息-班组名称': '技术研发班组',
      '组织信息-岗位名称': '电气工程师',
      '组织信息-岗位层级': '专业',
      '组织信息-岗位类别': '技术',
      '组织信息-岗位专业分类': '电气工程',
      '组织信息-岗位序列': 'T4',
      '职务信息-现任职务': '工程师',
      '职务信息-现任职务级别': '中级',
      '技术专家-技术专家等级': '中级',
      '技术专家-技术专家专业': '电气工程',
      '技能专家-技能专家等级': '',
      '技能专家-技能专家专业': '',
      '员工工作信息-任职年限': 4.3,
      '员工工作信息-现任岗位聘任日期': '2019-02-15',
      '员工工作信息-参加工作日期': '2013-07-01',
      '员工工作信息-连续工龄起算日期': '2013-07-01',
      '员工工作信息-入南网系统日期': '2013-07-01',
      '员工工作信息-入本单位日期': '2013-07-01',
      '员工联系信息-手机': '13900139000',
      '学历学位教育-有学历学位教育-(入学日期,毕业日期,毕业院校,院校类别)': '2009-09-01,2013-06-30,华南理工大学,211',
      '职称资格证书-多个职称资格证书-(资格名称,资格等级,专业名称,分支专业,资格取得时间,审批发证单位,是否当前证书,入库时间)': '电气工程师,中级,电气工程,电力系统,2017-08-10,电力行业协会,是,2017-09-01',
      '职称资格证书-当前-职称资格证书资格名称': '电气工程师',
      '职称资格证书-当前-职称资格证书资格等级': '中级',
      '职称资格证书-当前-职称资格证书专业名称': '电气工程',
      '职称资格证书-当前-职称资格证书分支专业': '电力系统',
      '职称资格证书-当前-职称资格证书资格取得时间': '2017-08-10',
      '职称资格证书-当前-职称资格证书审批发证单位': '电力行业协会',
      '职称资格证书-当前-职称资格证书入库时间': '2017-09-01',
      '岗位胜任能力资格证书-多个岗位胜任能力资格证书-(资格名称,岗位胜任能力证书等级,资格取得时间,审批发证单位,是否当前)': '电力系统工程师,中级,2018-05-15,电力行业协会,是',
      '岗位胜任能力资格证书-当前-岗位胜任能力资格证书资格名称': '电力系统工程师',
      '岗位胜任能力资格证书-当前-岗位胜任能力证书等级': '中级',
      '岗位胜任能力资格证书-当前-岗位胜任能力资格证书资格取得时间': '2018-05-15',
      '岗位胜任能力资格证书-当前-岗位胜任能力资格证书审批发证单位': '电力行业协会',
      '职业技能等级认定证书-多个职业技能等级认定证书-(资格名称,资格等级,工种名称,资格取得时间,审批发证单位,证书编号,入库时间,是否当前证书)': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书资格名称': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书资格等级': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书工种名称': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书资格取得时间': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书审批发证单位': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书证书编号': '',
      '职业技能等级认定证书-当前-职业技能等级认定证书入库时间': ''
    }
  ];
  
  // 创建工作表
  const worksheet = xlsx.utils.json_to_sheet(exampleData, { header: headers });
  
  // 设置列宽
  const colWidths = headers.map(header => {
    return { wch: Math.min(Math.max(header.length * 1.5, 10), 50) };
  });
  
  worksheet['!cols'] = colWidths;
  
  // 添加工作表到工作簿
  xlsx.utils.book_append_sheet(workbook, worksheet, '员工信息');
  
  // 创建说明工作表
  const instructionsData = [
    ['员工信息导入模板说明'],
    [''],
    ['1. 请按照模板格式填写员工信息，不要修改表头。'],
    ['2. 必填字段：员工基本信息-姓名、员工基本信息-员工编码、组织信息-部门路径、员工基本信息-政治面貌'],
    ['3. 日期格式请使用YYYY-MM-DD格式，例如：2023-04-19'],
    ['4. 多值字段请使用逗号分隔，例如：学历学位教育-有学历学位教育-(入学日期,毕业日期,毕业院校,院校类别)'],
    ['5. 导入时，系统会根据员工姓名和员工编码进行匹配，如果已存在则更新，不存在则新增'],
    ['6. 支持的政治面貌：中共党员、中共预备党员、共青团员、民主党派、群众'],
    ['7. 支持的文化程度：博士、硕士、本科、大专、中专、高中、初中及以下'],
    [''],
    ['字段说明：'],
    ['- 员工基本信息-姓名：员工姓名，必填'],
    ['- 员工基本信息-员工编码：员工工号，必填'],
    ['- 员工基本信息-性别：男/女'],
    ['- 员工基本信息-出生日期：格式YYYY-MM-DD'],
    ['- 员工基本信息-年龄：数字'],
    ['- 员工基本信息-民族：如汉族、满族等'],
    ['- 员工基本信息-籍贯：省市'],
    ['- 员工基本信息-工龄：数字，可带小数点'],
    ['- 员工基本信息-出生地：省市'],
    ['- 员工基本信息-文化程度：博士、硕士、本科、大专、中专、高中、初中及以下'],
    ['- 员工基本信息-政治面貌：中共党员、中共预备党员、共青团员、民主党派、群众'],
    ['- 组织信息-单位名称：所属单位'],
    ['- 组织信息-部门名称：所属部门'],
    ['- 组织信息-部门路径：完整的部门路径，如"公司/部门/科室"'],
    ['- 组织信息-班组名称：所属班组'],
    ['- 组织信息-岗位名称：当前岗位'],
    ['- 组织信息-岗位层级：如高级、中级、初级等'],
    ['- 组织信息-岗位类别：如管理、技术、操作等'],
    ['- 组织信息-岗位专业分类：如电气、机械、计算机等'],
    ['- 组织信息-岗位序列：如M1、T2等'],
    ['- 职务信息-现任职务：如主管、经理等'],
    ['- 职务信息-现任职务级别：如高级、中级、初级等'],
    ['- 技术专家-技术专家等级：如高级、中级、初级等'],
    ['- 技术专家-技术专家专业：如电气工程、机械工程等'],
    ['- 技能专家-技能专家等级：如高级技师、技师、高级工等'],
    ['- 技能专家-技能专家专业：如电工、焊工等'],
    ['- 员工工作信息-任职年限：数字，可带小数点'],
    ['- 员工工作信息-现任岗位聘任日期：格式YYYY-MM-DD'],
    ['- 员工工作信息-参加工作日期：格式YYYY-MM-DD'],
    ['- 员工工作信息-连续工龄起算日期：格式YYYY-MM-DD'],
    ['- 员工工作信息-入南网系统日期：格式YYYY-MM-DD'],
    ['- 员工工作信息-入本单位日期：格式YYYY-MM-DD'],
    ['- 员工联系信息-手机：手机号码'],
    ['- 学历学位教育-有学历学位教育-(入学日期,毕业日期,毕业院校,院校类别)：多值字段，用逗号分隔'],
    ['- 职称资格证书相关字段：职称资格证书信息'],
    ['- 岗位胜任能力资格证书相关字段：岗位胜任能力证书信息'],
    ['- 职业技能等级认定证书相关字段：职业技能等级认定证书信息']
  ];
  
  const instructionsWorksheet = xlsx.utils.aoa_to_sheet(instructionsData);
  
  // 设置列宽
  instructionsWorksheet['!cols'] = [{ wch: 100 }];
  
  // 添加说明工作表到工作簿
  xlsx.utils.book_append_sheet(workbook, instructionsWorksheet, '说明');
  
  // 确保输出目录存在
  const outputDir = path.dirname(outputPath);
  if (!fs.existsSync(outputDir)) {
    fs.mkdirSync(outputDir, { recursive: true });
  }
  
  // 写入文件
  xlsx.writeFile(workbook, outputPath);
  
  console.log(`员工信息导入模板已创建: ${outputPath}`);
  return outputPath;
}

// 如果直接运行此脚本
if (require.main === module) {
  const outputPath = path.join(__dirname, '../uploads/员工信息导入模板.xlsx');
  createEmployeeTemplate(outputPath);
}

module.exports = { createEmployeeTemplate };
